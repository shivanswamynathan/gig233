# Generated by Django 5.2.3 on 2025-07-09 05:44

from decimal import Decimal
from django.db import migrations, models


class Migration(migrations.Migration):

    dependencies = [
        ('document_processing', '0003_alter_grnsummary_unique_together_and_more'),
    ]

    operations = [
        migrations.CreateModel(
            name='InvoiceItemReconciliation',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('invoice_data_id', models.IntegerField(db_index=True, help_text='ID reference to the parent invoice record', verbose_name='Invoice Data ID')),
                ('invoice_item_data_id', models.IntegerField(db_index=True, help_text='ID reference to the invoice line item', verbose_name='Invoice Item Data ID')),
                ('grn_item_id', models.IntegerField(blank=True, db_index=True, help_text='ID reference to the matched GRN line item (null if no match)', null=True, verbose_name='GRN Item ID')),
                ('reconciliation_batch_id', models.CharField(db_index=True, help_text='Batch ID for tracking this reconciliation run', max_length=100, verbose_name='Reconciliation Batch ID')),
                ('match_status', models.CharField(choices=[('perfect_match', 'Perfect Match'), ('partial_match', 'Partial Match'), ('amount_mismatch', 'Amount Mismatch'), ('quantity_mismatch', 'Quantity Mismatch'), ('hsn_mismatch', 'HSN Code Mismatch'), ('description_mismatch', 'Description Mismatch'), ('no_match', 'No Match Found')], db_index=True, default='no_match', max_length=50, verbose_name='Item Match Status')),
                ('match_score', models.DecimalField(decimal_places=4, default=Decimal('0.0000'), help_text='Overall match score (0.0000 to 1.0000)', max_digits=5, verbose_name='Match Score')),
                ('hsn_match_score', models.DecimalField(decimal_places=4, default=Decimal('0.0000'), max_digits=5, verbose_name='HSN Match Score')),
                ('description_match_score', models.DecimalField(decimal_places=4, default=Decimal('0.0000'), max_digits=5, verbose_name='Description Match Score')),
                ('amount_match_score', models.DecimalField(decimal_places=4, default=Decimal('0.0000'), max_digits=5, verbose_name='Amount Match Score')),
                ('quantity_match_score', models.DecimalField(decimal_places=4, default=Decimal('0.0000'), max_digits=5, verbose_name='Quantity Match Score')),
                ('invoice_item_sequence', models.PositiveIntegerField(verbose_name='Invoice Item Sequence')),
                ('invoice_item_description', models.CharField(max_length=1000, verbose_name='Invoice Item Description')),
                ('invoice_item_hsn', models.CharField(blank=True, max_length=20, null=True, verbose_name='Invoice HSN Code')),
                ('invoice_item_quantity', models.DecimalField(blank=True, decimal_places=4, max_digits=15, null=True, verbose_name='Invoice Quantity')),
                ('invoice_item_unit', models.CharField(blank=True, max_length=20, null=True, verbose_name='Invoice Unit of Measurement')),
                ('invoice_item_unit_price', models.DecimalField(blank=True, decimal_places=4, max_digits=15, null=True, verbose_name='Invoice Unit Price')),
                ('invoice_item_subtotal', models.DecimalField(blank=True, decimal_places=2, max_digits=15, null=True, verbose_name='Invoice Item Subtotal')),
                ('invoice_item_cgst_rate', models.DecimalField(blank=True, decimal_places=2, max_digits=5, null=True, verbose_name='Invoice CGST Rate')),
                ('invoice_item_cgst_amount', models.DecimalField(blank=True, decimal_places=2, max_digits=15, null=True, verbose_name='Invoice CGST Amount')),
                ('invoice_item_sgst_rate', models.DecimalField(blank=True, decimal_places=2, max_digits=5, null=True, verbose_name='Invoice SGST Rate')),
                ('invoice_item_sgst_amount', models.DecimalField(blank=True, decimal_places=2, max_digits=15, null=True, verbose_name='Invoice SGST Amount')),
                ('invoice_item_igst_rate', models.DecimalField(blank=True, decimal_places=2, max_digits=5, null=True, verbose_name='Invoice IGST Rate')),
                ('invoice_item_igst_amount', models.DecimalField(blank=True, decimal_places=2, max_digits=15, null=True, verbose_name='Invoice IGST Amount')),
                ('invoice_item_total_tax', models.DecimalField(blank=True, decimal_places=2, max_digits=15, null=True, verbose_name='Invoice Total Tax Amount')),
                ('invoice_item_total_amount', models.DecimalField(blank=True, decimal_places=2, max_digits=15, null=True, verbose_name='Invoice Item Total Amount')),
                ('grn_item_description', models.CharField(blank=True, max_length=1000, null=True, verbose_name='GRN Item Description')),
                ('grn_item_hsn', models.CharField(blank=True, max_length=20, null=True, verbose_name='GRN HSN Code')),
                ('grn_item_quantity', models.DecimalField(blank=True, decimal_places=4, max_digits=15, null=True, verbose_name='GRN Received Quantity')),
                ('grn_item_unit', models.CharField(blank=True, max_length=20, null=True, verbose_name='GRN Unit of Measurement')),
                ('grn_item_unit_price', models.DecimalField(blank=True, decimal_places=4, max_digits=15, null=True, verbose_name='GRN Unit Price')),
                ('grn_item_subtotal', models.DecimalField(blank=True, decimal_places=2, max_digits=15, null=True, verbose_name='GRN Item Subtotal')),
                ('grn_item_cgst_rate', models.DecimalField(blank=True, decimal_places=2, max_digits=5, null=True, verbose_name='GRN CGST Rate')),
                ('grn_item_cgst_amount', models.DecimalField(blank=True, decimal_places=2, max_digits=15, null=True, verbose_name='GRN CGST Amount')),
                ('grn_item_sgst_rate', models.DecimalField(blank=True, decimal_places=2, max_digits=5, null=True, verbose_name='GRN SGST Rate')),
                ('grn_item_sgst_amount', models.DecimalField(blank=True, decimal_places=2, max_digits=15, null=True, verbose_name='GRN SGST Amount')),
                ('grn_item_igst_rate', models.DecimalField(blank=True, decimal_places=2, max_digits=5, null=True, verbose_name='GRN IGST Rate')),
                ('grn_item_igst_amount', models.DecimalField(blank=True, decimal_places=2, max_digits=15, null=True, verbose_name='GRN IGST Amount')),
                ('grn_item_total_tax', models.DecimalField(blank=True, decimal_places=2, max_digits=15, null=True, verbose_name='GRN Total Tax Amount')),
                ('grn_item_total_amount', models.DecimalField(blank=True, decimal_places=2, max_digits=15, null=True, verbose_name='GRN Item Total Amount')),
                ('quantity_variance', models.DecimalField(blank=True, decimal_places=4, help_text='Invoice Quantity - GRN Quantity', max_digits=15, null=True, verbose_name='Quantity Variance')),
                ('quantity_variance_percentage', models.DecimalField(blank=True, decimal_places=4, max_digits=8, null=True, verbose_name='Quantity Variance %')),
                ('subtotal_variance', models.DecimalField(blank=True, decimal_places=2, help_text='Invoice Subtotal - GRN Subtotal', max_digits=15, null=True, verbose_name='Subtotal Variance')),
                ('subtotal_variance_percentage', models.DecimalField(blank=True, decimal_places=4, max_digits=8, null=True, verbose_name='Subtotal Variance %')),
                ('cgst_variance', models.DecimalField(blank=True, decimal_places=2, max_digits=15, null=True, verbose_name='CGST Variance')),
                ('sgst_variance', models.DecimalField(blank=True, decimal_places=2, max_digits=15, null=True, verbose_name='SGST Variance')),
                ('igst_variance', models.DecimalField(blank=True, decimal_places=2, max_digits=15, null=True, verbose_name='IGST Variance')),
                ('total_tax_variance', models.DecimalField(blank=True, decimal_places=2, max_digits=15, null=True, verbose_name='Total Tax Variance')),
                ('total_amount_variance', models.DecimalField(blank=True, decimal_places=2, help_text='Invoice Total - GRN Total', max_digits=15, null=True, verbose_name='Total Amount Variance')),
                ('total_amount_variance_percentage', models.DecimalField(blank=True, decimal_places=4, max_digits=8, null=True, verbose_name='Total Amount Variance %')),
                ('unit_rate_variance', models.DecimalField(blank=True, decimal_places=4, help_text='Invoice Unit Price - GRN Unit Price', max_digits=15, null=True, verbose_name='Unit Rate Variance')),
                ('is_within_amount_tolerance', models.BooleanField(default=False, help_text='Whether amount variance is within configured tolerance', verbose_name='Within Amount Tolerance')),
                ('is_within_quantity_tolerance', models.BooleanField(default=False, help_text='Whether quantity variance is within configured tolerance', verbose_name='Within Quantity Tolerance')),
                ('tolerance_percentage_applied', models.DecimalField(decimal_places=2, default=Decimal('2.00'), max_digits=5, verbose_name='Amount Tolerance Applied (%)')),
                ('quantity_tolerance_percentage_applied', models.DecimalField(decimal_places=2, default=Decimal('5.00'), max_digits=5, verbose_name='Quantity Tolerance Applied (%)')),
                ('hsn_match_weight_applied', models.DecimalField(decimal_places=2, default=Decimal('0.40'), max_digits=3, verbose_name='HSN Match Weight Applied')),
                ('description_match_weight_applied', models.DecimalField(decimal_places=2, default=Decimal('0.30'), max_digits=3, verbose_name='Description Match Weight Applied')),
                ('amount_match_weight_applied', models.DecimalField(decimal_places=2, default=Decimal('0.30'), max_digits=3, verbose_name='Amount Match Weight Applied')),
                ('requires_review', models.BooleanField(default=False, help_text='Whether this item reconciliation needs manual review', verbose_name='Requires Review')),
                ('is_exception', models.BooleanField(default=False, help_text='Whether this item is flagged as an exception', verbose_name='Is Exception')),
                ('is_auto_matched', models.BooleanField(default=True, help_text='Whether this was automatically matched', verbose_name='Auto Matched')),
                ('reconciliation_notes', models.TextField(blank=True, help_text='Additional notes about this item reconciliation', null=True, verbose_name='Reconciliation Notes')),
                ('po_number', models.CharField(blank=True, db_index=True, max_length=200, null=True, verbose_name='PO Number')),
                ('invoice_number', models.CharField(blank=True, db_index=True, max_length=100, null=True, verbose_name='Invoice Number')),
                ('grn_number', models.CharField(blank=True, db_index=True, max_length=200, null=True, verbose_name='GRN Number')),
                ('vendor_name', models.CharField(blank=True, max_length=255, null=True, verbose_name='Vendor Name')),
                ('reconciled_at', models.DateTimeField(auto_now_add=True, verbose_name='Reconciled At')),
                ('updated_at', models.DateTimeField(auto_now=True, verbose_name='Updated At')),
            ],
            options={
                'verbose_name': 'Invoice Item Reconciliation',
                'verbose_name_plural': 'Invoice Item Reconciliations',
                'db_table': 'invoice_item_reconciliation',
                'ordering': ['-reconciled_at', 'invoice_item_sequence'],
                'indexes': [models.Index(fields=['invoice_data_id'], name='invoice_ite_invoice_f3623b_idx'), models.Index(fields=['invoice_item_data_id'], name='invoice_ite_invoice_a1237f_idx'), models.Index(fields=['grn_item_id'], name='invoice_ite_grn_ite_c8c301_idx'), models.Index(fields=['reconciliation_batch_id'], name='invoice_ite_reconci_31dacd_idx'), models.Index(fields=['match_status'], name='invoice_ite_match_s_8bca3d_idx'), models.Index(fields=['po_number'], name='invoice_ite_po_numb_fb53c4_idx'), models.Index(fields=['invoice_number'], name='invoice_ite_invoice_243fbf_idx'), models.Index(fields=['grn_number'], name='invoice_ite_grn_num_981922_idx'), models.Index(fields=['requires_review', 'is_exception'], name='invoice_ite_require_7b4ec4_idx'), models.Index(fields=['reconciled_at'], name='invoice_ite_reconci_8a1bf6_idx'), models.Index(fields=['invoice_item_hsn'], name='invoice_ite_invoice_c28673_idx'), models.Index(fields=['grn_item_hsn'], name='invoice_ite_grn_ite_0202f9_idx')],
                'unique_together': {('invoice_item_data_id', 'reconciliation_batch_id')},
            },
        ),
    ]
